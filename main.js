(()=>{"use strict";class t{static save(t){localStorage.setItem("cards",JSON.stringify(t))}static load(){return localStorage.getItem("cards")}}class e{constructor(){this.columnsContent=document.querySelector(".column-content"),this.columns=Array.from(document.querySelectorAll(".column")),this.forms=Array.from(document.getElementsByTagName("form")),this.draggedEl=null,this.ghostEl=null,this.todoList=document.getElementById("todo"),this.progressList=document.getElementById("inProgress"),this.doneList=document.getElementById("done"),this.topDiff=null,this.leftDiff=null}init(){console.log("init"),document.addEventListener("DOMContentLoaded",(()=>{console.log("pfufe"),this.load()})),this.action(),this.addItem()}addItem(){this.forms.forEach((t=>{t.addEventListener("submit",(e=>{e.preventDefault();const s=[...t.elements][0],n=t.closest(".column").querySelector(".column-content"),o=document.createElement("div");o.className="content-item",o.innerHTML=`<span class="item-text">${s.value}</span> <button type="submit" class="delete-item hidden">&#10006</button>`,n.appendChild(o),t.reset(),t.classList.add("add-form-hidden"),this.save()}))}))}action(){this.columns.forEach((t=>{t.addEventListener("click",(t=>{console.log(t.target),t.target.classList.contains("delete-item")?t.target.closest(".content-item").remove(t.target.parentElement):t.target.classList.contains("add-item")?t.target.parentElement.querySelector(".add-form").classList.toggle("add-form-hidden"):t.target.classList.contains("btn-cancel")&&t.target.parentElement.parentElement.classList.toggle("add-form-hidden"),this.save()})),t.addEventListener("mouseover",(t=>{t.target.classList.contains("content-item")&&t.target.querySelector(".delete-item").classList.remove("hidden")})),t.addEventListener("mouseout",(t=>{t.target.classList.contains("content-item")&&!t.relatedTarget.classList.contains("delete-item")&&t.target.querySelector(".delete-item").classList.add("hidden")})),t.addEventListener("mousedown",(t=>{if(!t.target.classList.contains("content-item"))return;t.preventDefault(),document.body.style.cursor="grabbing",this.draggedEl=t.target,this.ghostEl=t.target.cloneNode(!0),this.ghostEl.classList.add("dragged"),document.body.appendChild(this.ghostEl),this.ghostEl.style.width=`${this.draggedEl.offsetWidth}px`,this.ghostEl.style.left=`${this.draggedEl.getBoundingClientRect()}px`,this.ghostEl.style.top=`${this.draggedEl.getBoundingClientRect()}px`;const{top:e,left:s}=this.draggedEl.getBoundingClientRect();this.topDiff=t.pageY-e,this.leftDiff=t.pageX-s,this.draggedEl.classList.add("dragged-elem")})),t.addEventListener("mousemove",(t=>{t.preventDefault(),this.draggedEl&&(this.ghostEl.style.left=t.pageX-this.leftDiff+"px",this.ghostEl.style.top=t.pageY-this.topDiff+"px")})),t.addEventListener("mouseup",(t=>{if(t.preventDefault(),!this.draggedEl)return;const e=document.elementFromPoint(t.clientX,t.clientY),{top:s}=e.getBoundingClientRect(),n=e.closest(".column-content");n&&n!==e?(t.pageY>window.scrollY+s+e.offsetHeight/2?n.insertBefore(this.draggedEl,e.nextElementSibling):n.insertBefore(this.draggedEl,e),this.endMove(),this.save()):n?(n.appendChild(this.draggedEl),this.endMove(),this.save()):(this.endMove(),this.save())}))}))}endMove(){document.body.style.cursor="auto",document.body.removeChild(this.ghostEl),this.draggedEl.classList.remove("dragged-elem"),this.ghostEl=null,this.draggedEl=null}save(){const e=this.todoList.querySelectorAll(".content-item"),s=this.progressList.querySelectorAll(".content-item"),n=this.doneList.querySelectorAll(".content-item"),o={todo:[],progress:[],done:[]};e.forEach((t=>{const e=t.querySelector(".item-text");o.todo.push(e.textContent)})),s.forEach((t=>{const e=t.querySelector(".item-text");o.progress.push(e.textContent)})),n.forEach((t=>{const e=t.querySelector(".item-text");o.done.push(e.textContent)})),t.save(o)}load(){const e=JSON.parse(t.load());e&&(e.todo.forEach((t=>{const e=document.createElement("div");e.className="content-item",e.innerHTML=`<span class="item-text">${t}</span> <button type="submit" class="delete-item hidden">&#10006</button>`,this.todoList.querySelector(".column-content").appendChild(e)})),e.progress.forEach((t=>{const e=document.createElement("div");e.className="content-item",e.innerHTML=`<span class="item-text">${t}</span> <button type="submit" class="delete-item hidden">&#10006</button>`,this.progressList.querySelector(".column-content").appendChild(e)})),e.done.forEach((t=>{const e=document.createElement("div");e.className="content-item",e.innerHTML=`<span class="item-text">${t}</span> <button type="submit" class="delete-item hidden">&#10006</button>`,this.doneList.querySelector(".column-content").appendChild(e)})))}}document.addEventListener("DOMContentLoaded",(()=>{const t=new e;t.init(),t.load()}))})();